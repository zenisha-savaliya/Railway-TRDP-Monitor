<div class="page-card">
  <div class="page-header">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
    </svg>
    <h2>Write Data to Hardware</h2>
  </div>
  
  <div class="mb-6">
    <label class="block text-sm font-medium mb-3">Select Subsystem</label>
      <div class="subsystem-buttons">
        <button 
          *ngFor="let sub of configuredSubsystemNames"
          [class.active]="selectedSubsystem === sub"
          (click)="onSubsystemChange(sub)"
          class="btn btn-secondary"
        >
          {{ sub }}
        </button>
      </div>
      <div *ngIf="configuredSubsystemNames.length === 0" class="alert alert-warning">
        <p>No subsystems configured. Please configure subsystems first.</p>
      </div>
  </div>
  
  <div *ngIf="writableSignals.length === 0" class="alert alert-warning">
    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
      <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
    </svg>
    <p>No writable signals configured for {{ selectedSubsystem }} subsystem</p>
  </div>
  
  <div *ngIf="writableSignals.length > 0" class="common-save-bar">
    <button (click)="sendAllWriteData()" class="btn btn-primary btn-save-all" [disabled]="isSavingAll">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
      </svg>
      {{ isSavingAll ? 'Saving...' : 'Save All to ' + selectedSubsystem }}
    </button>
    <button (click)="sendAllSubsystems()" class="btn btn-success btn-save-all-subsystems" [disabled]="isSavingAll">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      {{ isSavingAll ? 'Saving...' : 'Save to All Subsystems' }}
    </button>
  </div>
  
  <div *ngFor="let comid of groupedByComId | keyvalue" class="comid-group">
    <div class="comid-header">
      <h3>COM ID: {{ comid.key }}</h3>
    </div>
    <div class="write-signals-container">
      <div *ngFor="let signal of comid.value" class="write-signal-item">
        <div class="signal-info">
          <h4>{{ signal.name }}</h4>
          <p>Type: {{ signal.datatype }} â€¢ Access: {{ signal.access }}</p>
        </div>
        <div *ngIf="signal.datatype === 'BOOLEAN' || signal.datatype === 'BIT'" class="boolean-controls">
          <button 
            type="button"
            class="toggle-button-write" 
            [class.active]="writeData[signal.id] === true || writeData[signal.id] === 1"
            (click)="writeData[signal.id] = writeData[signal.id] ? false : true"
          >
            <div class="toggle-slider-write" [class.active]="writeData[signal.id] === true || writeData[signal.id] === 1">
              <div class="toggle-knob-write"></div>
            </div>
            <span class="toggle-label-write">{{ (writeData[signal.id] === true || writeData[signal.id] === 1) ? 'ON (1)' : 'OFF (0)' }}</span>
          </button>
          <button 
            (click)="writeSignalValue(signal.id, writeData[signal.id])"
            class="btn btn-success"
          >
            Send
          </button>
        </div>
        <div *ngIf="signal.datatype !== 'BOOLEAN' && signal.datatype !== 'BIT'" class="numeric-controls">
          <input 
            type="number"
            [step]="signal.datatype.includes('FLOAT') ? '0.01' : '1'"
            [(ngModel)]="writeData[signal.id]"
            [placeholder]="'Enter value (scaling: ' + signal.scaling + ')'"
            class="form-input"
          />
          <button 
            (click)="writeSignalValue(signal.id, writeData[signal.id])"
            class="btn btn-success"
          >
            Send
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <div *ngIf="writableSignals.length > 0" class="common-save-bar common-save-bar-bottom">
    <button (click)="sendAllWriteData()" class="btn btn-primary btn-save-all" [disabled]="isSavingAll">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
      </svg>
      {{ isSavingAll ? 'Saving...' : 'Save All to ' + selectedSubsystem }}
    </button>
    <button (click)="sendAllSubsystems()" class="btn btn-success btn-save-all-subsystems" [disabled]="isSavingAll">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      {{ isSavingAll ? 'Saving...' : 'Save to All Subsystems' }}
    </button>
  </div>
</div>
